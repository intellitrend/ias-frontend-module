<?xml version="1.0" encoding="UTF-8"?>
<zabbix_export>
    <version>5.0</version>
    <date>2021-04-07T09:44:10Z</date>
    <media_types>
        <media_type>
            <name>IntelliTrend Advanced Services</name>
            <type>WEBHOOK</type>
            <parameters>
                <parameter>
                    <name>ias_url</name>
                    <value>http://zabbix-server:3900/api/webhook</value>
                </parameter>
                <parameter>
                    <name>trigger_id</name>
                    <value>{TRIGGER.ID}</value>
                </parameter>
                <parameter>
                    <name>trigger_status</name>
                    <value>{TRIGGER.STATUS}</value>
                </parameter>
            </parameters>
            <max_sessions>0</max_sessions>
            <attempts>1</attempts>
            <script>try {
    var logtag = '[ IntelliTrend Advanced Services Webhook ] ';
    var params = JSON.parse(value);
    var url = params.ias_url;

    if (!url) {
        throw 'Missing param ias_url';
    }

    var req = new CurlHttpRequest();

    if (typeof params.HTTPProxy === 'string' &amp;&amp; params.HTTPProxy.trim() !== '') {
        req.SetProxy(params.HTTPProxy);
    }

    req.AddHeader('Content-Type: application/json');
    
    var body = {
        trigger_id: parseInt(params.trigger_id),
        trigger_status: params.trigger_status != &quot;OK&quot;
    };

    var bodystr = JSON.stringify(body);
    Zabbix.Log(4, logtag + 'Request: ' + bodystr);

    var respstr = req.Post(url, bodystr);
    Zabbix.Log(4, logtag + 'Response: ' + respstr);

    var resp = JSON.parse(respstr);
    if (!resp.success) {
        throw 'API error: ' + resp.message;
    }

    return resp.message;
} catch (error) {
    Zabbix.Log(3, logtag + 'ERROR: ' + error);
    throw 'Sending failed: ' + error;
}</script>
            <message_templates>
                <message_template>
                    <event_source>TRIGGERS</event_source>
                    <operation_mode>PROBLEM</operation_mode>
                </message_template>
                <message_template>
                    <event_source>TRIGGERS</event_source>
                    <operation_mode>RECOVERY</operation_mode>
                </message_template>
                <message_template>
                    <event_source>TRIGGERS</event_source>
                    <operation_mode>UPDATE</operation_mode>
                </message_template>
                <message_template>
                    <event_source>DISCOVERY</event_source>
                    <operation_mode>PROBLEM</operation_mode>
                </message_template>
                <message_template>
                    <event_source>AUTOREGISTRATION</event_source>
                    <operation_mode>PROBLEM</operation_mode>
                </message_template>
                <message_template>
                    <event_source>INTERNAL</event_source>
                    <operation_mode>PROBLEM</operation_mode>
                </message_template>
                <message_template>
                    <event_source>INTERNAL</event_source>
                    <operation_mode>RECOVERY</operation_mode>
                </message_template>
            </message_templates>
        </media_type>
    </media_types>
</zabbix_export>
